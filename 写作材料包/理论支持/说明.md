零通胀泊松（Zero-Inflated Poisson, ZIP）模型是一种用于处理过多零值的计数数据的统计模型。它结合了泊松回归和逻辑回归，用于建模零值和非零值的生成过程。ZIP 模型假设数据生成过程由两个部分组成：

零通胀部分：生成额外的零值。
泊松部分：生成非零值，通常使用泊松分布。
ZIP 模型的原理
ZIP 模型的基本思想是将数据生成过程分为两个步骤：

逻辑回归部分：首先使用逻辑回归模型来预测数据点是否为零。这个部分生成一个概率值 ($\pi$)，表示数据点为零的概率。
泊松回归部分：对于非零数据点，使用泊松回归模型来预测其值。这个部分生成一个泊松分布的参数 ($\lambda$)，表示非零数据点的平均值。
数学表示
ZIP 模型的概率密度函数可以表示为：

$[ P(Y = y) = \begin{cases} \pi + (1 - \pi) \cdot e^{-\lambda} & \text{if } y = 0 \ (1 - \pi) \cdot \frac{\lambda^y e^{-\lambda}}{y!} & \text{if } y > 0 \end{cases} ]$

其中：

($\pi$) 是零通胀部分的概率，由逻辑回归模型估计。
($\lambda$) 是泊松部分的参数，由泊松回归模型估计。
预测步骤
估计模型参数：使用训练数据拟合 ZIP 模型，估计逻辑回归部分的参数（用于计算 ($\pi$)）和泊松回归部分的参数（用于计算 ($\lambda$)）。
计算零通胀概率 ($\pi$)：对于每个预测样本，使用逻辑回归部分的参数计算其为零的概率 ($\pi$)。
计算泊松参数 ($\lambda$)：对于每个预测样本，使用泊松回归部分的参数计算其泊松分布的参数 ($\lambda$)。
生成预测值：结合 ($\pi$) 和 ($\lambda$)，生成预测值。

### 零奖牌拿到首个牌概率
$p_{zero}=\pi + (1-\pi)e^{-\lambda}$
在具有neverwon标签的国家上使用

期望=$\Sigma_{\in neverWon}[\pi_{c,2028}(1-\pi_{c,2028})e^{-\lambda _{c,2028}}]$

### did双重差分估计
选择处理组和对照组：处理组是受到干预或事件影响的群体，对照组是未受到干预或事件影响的群体。\
计算处理组和对照组在事件发生前后的平均值：\
处理组在事件发生前的平均值：$(\bar{Y}_{T, \text{pre}})$\
处理组在事件发生后的平均值：$(\bar{Y}_{T, \text{post}})$\
对照组在事件发生前的平均值：$(\bar{Y}_{C, \text{pre}})$\
对照组在事件发生后的平均值：$(\bar{Y}_{C, \text{post}})$\
计算处理组和对照组的变化量：\
处理组的变化量：$(\Delta Y_T = \bar{Y}{T, \text{post}} - \bar{Y}{T, \text{pre}})$\
对照组的变化量：$(\Delta Y_C = \bar{Y}{C, \text{post}} - \bar{Y}{C, \text{pre}})$\
计算双重差分估计量：\
处理效应估计量：$(\text{DiD} = \Delta Y_T - \Delta Y_C)$\
$[\text{DiD} = (\bar{Y}{T, \text{post}} - \bar{Y}{T, \text{pre}}) - (\bar{Y}{C, \text{post}} - \bar{Y}{C, \text{pre}})]$

处理组：某国某项目\
对照组：其他国家在同⼀项⽬或同⼀国家在相似项⽬中进⾏匹配

+ 就是说必定是0就零膨胀
+ 不是0就是泊松分布
+ neverwon就是说一个国家从来没有拿过奖牌，那么其在2028拿奖牌的概率小
+ 泊松部分写出来就是$p=系数_1+y_t+c+系数_2\times东道主+系数_3\times项目数+系数_4\times lag$
    + $y_t$以及c是续集效应，一个是国家，一个是年份
+ lag是滞后特征，就是时序模型的那个之后特征，模型用了过往3届的之后特征
    + 就是过往数据乘上一个权重然后加起来

+ 评估的话用的是对数似然
    + 然而现在数据不太好看，随机结果合理
### 断点相关
+ 累积和检验（CUSUM）\
CUSUM 控制图通过计算每个数据点与目标值之间的偏差，并累积这些偏差，来检测数据中的变化。其基本思想是，如果过程处于控制状态，累积和应该在一个较小的范围内波动；如果过程发生了变化，累积和会显著偏离零。
假设我们有一个时间序列数据 $( X_1, X_2, \ldots, X_n )$，目标值为 $( \mu )$，CUSUM 控制图的累积和 $( C_t )$ 可以表示为：

$[ C_t = \sum_{i=1}^{t} (X_i - \mu) ]$

其中：

$( X_i )$ 是第 $( i )$ 个数据点。
$( \mu )$ 是目标值或过程均值。
+ 偏差处就是断点

### 步骤
1. 清除异常字符，创建year-country映射字典
2. 创建ishost标签以及neverwon标签（近5届无奖牌）
3. 构建滞后特征，即前三年的奖牌，权重0.6，0.3，0.1
4. 建立ZIP模型
    + poisson部分自变量ishost,lag,year
    + 零通胀就是neverwon
    + 因变量是总奖牌
5. 对模型进行拟合
6. 使用模型预测2028
    + 前三届的滞后特征

### 思考过程
1. 一开始观察到数据较少，数据规律不明显，故使用灰色预测模型
2. 但灰色预测效果不佳，模型预测结果不稳定，个别国家的预测结果不合理；经过试验后发现，灰色预测更适合单调，具有指数增长规律的序列；对包含0的序列需要格外的平移
3. 观察到数据中有较多的0，存在显著的零通量；东道主等因素对结果有较大影响，故选用零通胀泊松模型（Zero-Inflated Poisson, ZIP），输出主要是国家的总奖牌数
4. 训练并预测2028，并与灰色预测模型对比
5. 研究伟大教练效应：检测数据中断点，并进行DID分析（Difference-in-Differences），排除其它的公共因素（验证该断点并⾮公共
趋势）


























